<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞—Ä—Ç–∞ –∞—Ñ—Ñ–∏–ª–∏–∞—Ü–∏–∏ ‚Äî –§–∏–Ω–∞–Ω—Å–æ–≤–æ–µ —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/vis-network/9.1.2/standalone/umd/vis-network.min.js"></script>
    <style>
        #network-container { width: 100%; height: calc(100vh - 64px); background-color: #0f172a; }
        .vis-network:focus { outline: none; }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #1e293b; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #475569; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #64748b; }
        @keyframes pulse-red { 0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); } 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); } }
        .risk-pulse { border-left: 4px solid #ef4444; animation: pulse-red 2s infinite; }
    </style>
</head>
<body class="bg-slate-900 overflow-hidden text-slate-200 font-sans">

    <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
    <header class="bg-slate-800 border-b border-slate-700 h-16 flex items-center justify-between px-6 z-10 relative shadow-md">
        <div class="flex items-center space-x-4">
            <span class="font-bold text-slate-100 tracking-wider">–§–û–†–ï–ù–ó–ò–ö –ê–ù–ê–õ–ò–ó</span>
            <div class="h-6 w-px bg-slate-600"></div>
            <button onclick="highlightPattern('npo')" class="text-xs bg-slate-700 hover:bg-indigo-600 text-slate-200 px-3 py-1.5 rounded transition-colors font-bold border border-slate-600">
                üõ°Ô∏è 1. –°–∫—Ä—ã—Ç—ã–µ –∞–∫—Ç–∏–≤—ã (–ù–ö–û)
            </button>
            <button onclick="highlightPattern('hub')" class="text-xs bg-slate-700 hover:bg-purple-600 text-slate-200 px-3 py-1.5 rounded transition-colors font-bold border border-slate-600">
                üï∏Ô∏è 2. –ú–µ–≥–∞-–•–∞–±—ã
            </button>
            <button onclick="highlightPattern('split')" class="text-xs bg-slate-700 hover:bg-orange-600 text-slate-200 px-3 py-1.5 rounded transition-colors font-bold border border-slate-600">
                ‚úÇÔ∏è 3. –î—Ä–æ–±–ª–µ–Ω–∏–µ –∏ –í—ã–≤–æ–¥
            </button>
        </div>
        <div class="flex items-center space-x-3">
            <input type="text" id="node-search" placeholder="–ü–æ–∏—Å–∫ (–§–ò–û, –ò–ù–ù)..." class="bg-slate-900 border border-slate-600 rounded px-4 py-1.5 text-sm text-slate-200 focus:ring-1 focus:ring-blue-500 outline-none w-64 font-mono">
            <button onclick="resetView()" class="bg-slate-700 text-slate-200 px-4 py-1.5 rounded text-xs font-bold hover:bg-slate-600 transition-all uppercase border border-slate-600">–°–±—Ä–æ—Å</button>
        </div>
    </header>

    <main class="relative">
        <div id="network-container"></div>

        <!-- –ü–∞–Ω–µ–ª—å —Å –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–º –≤—ã–≤–æ–¥–æ–º -->
        <div id="analytic-report" class="absolute top-6 left-6 w-96 bg-slate-800/95 backdrop-blur-md shadow-2xl border border-slate-600 p-5 hidden z-20 rounded-lg">
            <div class="flex justify-between items-start mb-2">
                <h3 id="report-title" class="text-lg font-bold text-white uppercase tracking-wide"></h3>
                <button onclick="closeReport()" class="text-slate-400 hover:text-white font-bold text-xl">&times;</button>
            </div>
            <p id="report-text" class="text-sm text-slate-300 leading-relaxed mb-4"></p>
            <div id="report-nodes" class="space-y-2 max-h-48 overflow-y-auto custom-scrollbar pr-2"></div>
        </div>

        <!-- –°–∞–π–¥–±–∞—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± —É–∑–ª–µ -->
        <div id="info-sidebar" class="absolute top-6 right-6 w-96 bg-slate-800/95 backdrop-blur-md shadow-2xl border border-slate-600 p-6 hidden z-20 overflow-y-auto max-h-[85vh] custom-scrollbar rounded-lg">
            <button onclick="closeSidebar()" class="absolute top-4 right-4 text-slate-400 hover:text-white font-bold text-xl">&times;</button>
            <div id="info-content"></div>
        </div>
    </main>

    <script>
        // –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï
        const rawNodes = [
            // --- –ö–õ–ê–ù –ß–£–ì–£–ù–û–í–´–• ---
            { id: 'C1', label: '–ß—É–≥—É–Ω–æ–≤ –õ. –°.', group: 'person', inn: '773011485444', info: '–ë–µ–Ω–µ—Ñ–∏—Ü–∏–∞—Ä –û–û–û "–≠–ª—å—Ç–æ–Ω-–ú–µ–¥". –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É—é—â–µ–µ –ª–∏—Ü–æ –û–û–û "–°–∞–Ω–∞—Ç–æ—Ä–∏–π –≠–ª—å—Ç–æ–Ω-2".', riskPattern: ['hub', 'split'] },
            { id: 'BA', label: '–ë–∞–≥—Ä–æ–≤–∞ –ò. –ê.', group: 'person', inn: '503610217620', info: '–£—á—Ä–µ–¥–∏—Ç–µ–ª—å –û–û–û "–≠–ª—å—Ç–æ–Ω-–ú–µ–¥" (50%). –°—É–ø—Ä—É–≥–∞ –ß—É–≥—É–Ω–æ–≤–∞ –õ.–°.', riskPattern: ['split'] },
            { id: 'CA', label: '–ß—É–≥—É–Ω–æ–≤ –ê. –í.', group: 'person', inn: '772829287610', info: '–ì–µ–Ω–µ—Ä–∞–ª—å–Ω—ã–π –¥–∏—Ä–µ–∫—Ç–æ—Ä –û–û–û "–≠–ª—å—Ç–æ–Ω-–ú–µ–¥" (—Å 12.2023). –°—ã–Ω –ß—É–≥—É–Ω–æ–≤–∞ –õ.–°.', riskPattern: ['split'] },
            { id: 'EM', label: '–û–û–û "–≠–õ–¨–¢–û–ù-–ú–ï–î"', group: 'company', inn: '7725262133', info: '–ê—Ä–µ–Ω–¥–∞—Ç–æ—Ä-–≤—ã–≥–æ–¥–æ–ø—Ä–∏–æ–±—Ä–µ—Ç–∞—Ç–µ–ª—å. –û—Ç–≤–µ—Ç—á–∏–∫ –ø–æ –∏—Å–∫—É –æ –≤–∑—ã—Å–∫–∞–Ω–∏–∏ 42,1 –º–ª–Ω —Ä—É–±.', riskPattern: ['split'] },
            { id: 'C4', label: '–ó–ê–û "–ü–ê–°–°–ê–ñ –û–ö–¢–Ø–ë–†–¨–°–ö–û–ï –ü–û–õ–ï"', group: 'company', inn: '7734125831', riskPattern: ['hub'] },
            { id: 'C6', label: '–¢–°–ù "–ò–°–¢–¨–ò–ù–°–ö–ê–Ø –†–ï–í–¨–ï–†–ê"', group: 'company', inn: '4007009680' },
            { id: 'C7', label: '–ö–ª–∏–º–µ—à–∏–Ω–∞ –ï. –í.', group: 'person', info: '–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å –¢–°–ù "–ò—Å—Ç—å–∏–Ω—Å–∫–∞—è –†–∏–≤—å–µ—Ä–∞".' },
            { id: 'A1', label: '–ê–ª—Ç—É—Ö–æ–≤ –î. –ù.', group: 'person', inn: '772154125550', info: '–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∞—è —Å–≤—è–∑—å —Å –∫–æ–Ω—Ç—É—Ä–æ–º –ß—É–≥—É–Ω–æ–≤–∞.' },

            // --- –ö–õ–ê–ù –ë–û–ì–î–ê–ù–û–í–´–• ---
            { id: 'B1', label: '–ë–æ–≥–¥–∞–Ω–æ–≤ –ê. –í.', group: 'responsible', inn: '344402661996', info: '–ë—ã–≤—à–∏–π –≥–µ–Ω–¥–∏—Ä–µ–∫—Ç–æ—Ä –≠–ª—å—Ç–æ–Ω-2. –ò—Å–∫ –æ–± —É–±—ã—Ç–∫–∞—Ö –Ω–∞ 43,8 –º–ª–Ω —Ä—É–±.', riskPattern: ['npo'] },
            { id: 'B2', label: '–ë–æ–≥–¥–∞–Ω–æ–≤–∞ –í. –î.', group: 'person', inn: '344401302306', info: '–°—É–ø—Ä—É–≥–∞ –ë–æ–≥–¥–∞–Ω–æ–≤–∞ –ê.–í. –¢–°–ñ "–ò–∑—É–º—Ä—É–¥".', riskPattern: ['npo'] },
            { id: 'BR', label: '–ë–æ–≥–¥–∞–Ω–æ–≤ –†. –í.', group: 'person', inn: '344406860985', info: '–°—ã–Ω –ë–æ–≥–¥–∞–Ω–æ–≤–∞ –ê.–í.' },
            { id: 'BD1', label: '–ë–æ–≥–¥–∞–Ω–æ–≤–∞ (–¥–æ—á—å)', group: 'person' },
            { id: 'TS1', label: '–¢–°–ñ "–ò–ó–£–ú–†–£–î"', group: 'org' },
            { id: 'B4', label: '–û–û–û "–¢–ê–°–ú"', group: 'company' },
            { id: 'B5', label: '–û–û–û "–ê–í–¢–û–ü–õ–Æ–°"', group: 'toxic', info: '–õ–∏–∫–≤–∏–¥–∏—Ä–æ–≤–∞–Ω–æ.' },

            // --- –ú–ï–ù–ï–î–ñ–ú–ï–ù–¢ –ò –õ–ò–ö–í–ò–î–ê–¢–û–†–´ ---
            { id: 'K1', label: '–ö–æ–ª–µ—Å–Ω–∏–∫–æ–≤ –ì. –í.', group: 'manager', inn: '344553063733', info: '–î–∏—Ä–µ–∫—Ç–æ—Ä –û–û–û "–°–∞–º–æ—Ä–æ–≥–¥–∞". –ë—ã–≤—à–∏–π –≥–µ–Ω–¥–∏—Ä–µ–∫—Ç–æ—Ä –≠–ª—å—Ç–æ–Ω-2.', riskPattern: ['split'] },
            { id: 'S1', label: '–û–û–û "–°–ê–ú–û–†–û–ì–î–ê"', group: 'company', inn: '3443142909', info: '–ü–æ—Å—Ç–∞–≤—â–∏–∫ —Ä–∞–ø—ã. –®—Ç–∞—Ç: 1 —á–µ–ª. –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –≤—ã–≤–æ–¥–∞ —Å—Ä–µ–¥—Å—Ç–≤.', riskPattern: ['split'] },
            { id: 'Z1', label: '–ó–∞—Ö–∞—Ä–æ–≤–∞ –ï. –ê.', group: 'manager', inn: '344402653258', info: '–î–∏—Ä–µ–∫—Ç–æ—Ä –Æ–∂–Ω–æ—Ä—É—Å—Å–∫–æ–≥–æ –ù–ü–ó. –≠–∫—Å-–¥–∏—Ä–µ–∫—Ç–æ—Ä –≠–ª—å—Ç–æ–Ω-2.', riskPattern: ['npo'] },
            { id: 'MI1', label: '–ú–∏—Ö–µ–µ–≤ –°. –ò.', group: 'manager', inn: '344804750156', info: '–ë—ã–≤—à–∏–π –≥–µ–Ω–¥–∏—Ä–µ–∫—Ç–æ—Ä –≠–ª—å—Ç–æ–Ω-2.' },
            { id: 'L1', label: '–û–û–û "–°–û–ì–õ–ê–°–ò–ï"', group: 'toxic', info: '–ù–µ –¥–µ–π—Å—Ç–≤—É–µ—Ç. –°–≤—è–∑—å: –ö–æ–ª–µ—Å–Ω–∏–∫–æ–≤.' },
            { id: 'L2', label: '–û–û–û "–†–ò–≠–õ–¢ –¶–ï–ù–¢–† –í–û–õ–ì–ê–°–ò–¢–ò"', group: 'toxic', info: '–ù–µ –¥–µ–π—Å—Ç–≤—É–µ—Ç.' },

            // --- –ë–ê–ù–ö–†–û–¢–°–¢–í–û –ò –ê–†–ë–ò–¢–†–ê–ñ ---
            { id: 'E2', label: '–û–û–û "–°–ê–ù–ê–¢–û–†–ò–ô –≠–õ–¨–¢–û–ù-2"', group: 'toxic', inn: '3423020050', info: '–ë–∞–Ω–∫—Ä–æ—Ç. –î–æ–ª–≥ > 1 –º–ª—Ä–¥. –î–æ–ª–≥ –ø–æ –∞—Ä–µ–Ω–¥–µ: 42,1 –º–ª–Ω —Ä—É–±.', riskPattern: ['split'] },
            { id: 'K2', label: '–•–∞—Ä—á–µ–Ω–∫–æ –°. –í.', group: 'official', inn: '343501325922', info: '–ö–æ–Ω–∫—É—Ä—Å–Ω—ã–π —É–ø—Ä–∞–≤–ª—è—é—â–∏–π (—Å 25.03.2025).' },
            { id: 'V1', label: '–û–û–û "–ö–û–†–ü–û–†–ê–¶–ò–Ø –í–û–õ–ú–ê"', group: 'responsible', info: '–ö—Ä–µ–¥–∏—Ç–æ—Ä (162 –º–ª–Ω —Ä—É–±). –í—ã–∫—É–ø–∏–ª–∞ –¥–æ–ª–≥ —É –§–ù–°.' },
            { id: 'TA1', label: '–û–û–û "–¢–ê–ö–¢–ò–ö–ê-–ê–£–î–ò–¢"', group: 'company' },

            // --- –ë–õ–û–ö –ù–ü–ó ---
            { id: 'N1', label: '–û–û–û "–Æ–ñ–ù–û–†–£–°–°–ö–ò–ô –ù–ü–ó"', group: 'company', inn: '3444273118' },
            { id: 'N2', label: '–û–ê–û "–Æ–ñ–ù–û–†–£–°–°–ö–ò–ô –ù–ü–ó"', group: 'toxic', info: '–õ–∏–∫–≤–∏–¥–∏—Ä–æ–≤–∞–Ω.' },
            { id: 'N3', label: '–®–º–∞–ª—å –ì. –ò.', group: 'person' },
            { id: 'N4', label: '–ú—É–≥–∞–¥–∞–µ–≤ –ú. –ê.', group: 'person' },
            { id: 'N5', label: '–ö—Ä–∞–≤—á–µ–Ω–∫–æ –ù. –í.', group: 'person' },
            { id: 'N6', label: '–ó–∞–∫–∞–µ–≤ –†. –ì.', group: 'person' },
            { id: 'N7', label: '–ü–æ–≥–æ—Å—è–Ω –†. –°.', group: 'person' },
            { id: 'N8', label: '–ü–æ–¥–≥–æ—Ä–Ω—ã–π –ò. –ê.', group: 'person' },

            // --- –•–ê–ë–´ ---
            { id: 'P1', label: '–ü–†–ò–•–û–î –•–†–ê–ú–ê –ê–õ. –ù–ï–í–°–ö–û–ì–û', group: 'org', inn: '3444056096', riskPattern: ['npo'] },
            { id: 'P2', label: '–ö–∞–∑–∞–Ω–æ–≤ –ù. –õ.', group: 'person', riskPattern: ['npo'] },
            { id: 'MP1', label: '–ê–°–°–û–¶–ò–ê–¶–ò–Ø "–ú–ï–ì–ê–ü–ò–†"', group: 'org', riskPattern: ['hub'] },
            { id: 'M2', label: '–ö–∞–Ω—à–∏–Ω –ê. –ê.', group: 'person', riskPattern: ['hub'] }
        ];

        const rawEdges = [
            { from: 'C1', to: 'EM', label: '–£—á—Ä–µ–¥–∏—Ç–µ–ª—å' },
            { from: 'BA', to: 'EM', label: '–£—á—Ä–µ–¥–∏—Ç–µ–ª—å' },
            { from: 'CA', to: 'EM', label: '–î–∏—Ä–µ–∫—Ç–æ—Ä' },
            { from: 'A1', to: 'EM', label: '–°–≤—è–∑—å' },
            { from: 'C1', to: 'E2', label: '–ö–æ–Ω—Ç—Ä–æ–ª—å' },
            { from: 'E2', to: 'EM', label: '–ê—Ä–µ–Ω–¥–∞' },
            { from: 'C1', to: 'BA', label: '–°—É–ø—Ä—É–≥–∏', dashes: true },
            { from: 'C1', to: 'CA', label: '–û—Ç–µ—Ü/–°—ã–Ω' },
            { from: 'B1', to: 'E2', label: '–£–±—ã—Ç–∫–∏ (43.8 –º–ª–Ω)' },
            { from: 'B1', to: 'B2', label: '–°—É–ø—Ä—É–≥–∏', dashes: true },
            { from: 'B1', to: 'BR', label: '–û—Ç–µ—Ü/–°—ã–Ω' },
            { from: 'B1', to: 'BD1', label: '–û—Ç–µ—Ü/–î–æ—á—å' },
            { from: 'B2', to: 'TS1', label: '–ü—Ä–µ–¥—Å–µ–¥–∞—Ç–µ–ª—å' },
            { from: 'B2', to: 'B4', label: '–£—á—Ä–µ–¥–∏—Ç–µ–ª—å' },
            { from: 'K2', to: 'E2', label: '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ' },
            { from: 'K2', to: 'EM', label: '–ò—Å–∫ (42.1 –º–ª–Ω)' },
            { from: 'V1', to: 'E2', label: '–ö—Ä–µ–¥–∏—Ç–æ—Ä' },
            { from: 'B1', to: 'TA1', label: '–ê—É–¥–∏—Ç' },
            { from: 'K1', to: 'E2', label: '–≠–∫—Å-–¥–∏—Ä–µ–∫—Ç–æ—Ä' },
            { from: 'Z1', to: 'E2', label: '–≠–∫—Å-–¥–∏—Ä–µ–∫—Ç–æ—Ä' },
            { from: 'MI1', to: 'E2', label: '–≠–∫—Å-–¥–∏—Ä–µ–∫—Ç–æ—Ä' },
            { from: 'K1', to: 'S1', label: '–î–∏—Ä–µ–∫—Ç–æ—Ä' },
            { from: 'S1', to: 'E2', label: '–ü–æ—Å—Ç–∞–≤–∫–∞ —Ä–∞–ø—ã' },
            { from: 'K1', to: 'L1', label: '–õ–∏–∫–≤–∏–¥–∞—Ç–æ—Ä' },
            { from: 'N1', to: 'N3', label: '–°–≤—è–∑—å' },
            { from: 'N1', to: 'N4', label: '–°–≤—è–∑—å' },
            { from: 'N1', to: 'N5', label: '–°–≤—è–∑—å' },
            { from: 'N1', to: 'N6', label: '–°–≤—è–∑—å' },
            { from: 'N1', to: 'N7', label: '–°–≤—è–∑—å' },
            { from: 'N1', to: 'N8', label: '–°–≤—è–∑—å' },
            { from: 'B1', to: 'N1', label: '–ö–æ–Ω—Ç—Ä–æ–ª—å' },
            { from: 'C1', to: 'N1', label: '–ê–∫—Ü–∏–æ–Ω–µ—Ä' },
            { from: 'C1', to: 'C4', label: '–î–∏—Ä–µ–∫—Ç–æ—Ä' },
            { from: 'C4', to: 'MP1', label: '–£—á—Ä–µ–¥–∏—Ç–µ–ª—å' },
            { from: 'MP1', to: 'M2', label: '–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å' },
            { from: 'P2', to: 'P1', label: '–ù–∞—Å—Ç–æ—è—Ç–µ–ª—å' },
            { from: 'B1', to: 'P1', label: '–£—á—Ä–µ–¥–∏—Ç–µ–ª—å' },
            { from: 'B2', to: 'P1', label: '–£—á—Ä–µ–¥–∏—Ç–µ–ª—å' },
            { from: 'Z1', to: 'P1', label: '–°–≤—è–∑—å' },
            { from: 'C1', to: 'C6', label: '–ó–∞—Å—Ç—Ä–æ–π—â–∏–∫' },
            { from: 'C6', to: 'C7', label: '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ' }
        ];

        const nodes = new vis.DataSet(rawNodes);
        const edges = new vis.DataSet(rawEdges);

        const options = {
            nodes: { font: { size: 12, color: '#f8fafc' }, borderWidth: 2, shadow: { enabled: true, color: 'rgba(0,0,0,0.8)' } },
            edges: { width: 1.5, color: { color: '#475569' }, arrows: { to: { enabled: true, scaleFactor: 0.5 } }, font: { size: 10, color: '#cbd5e1', strokeWidth: 0 }, smooth: true },
            groups: {
                person: { color: { background: '#1e293b', border: '#3b82f6' }, shape: 'dot' },
                responsible: { color: { background: '#1e293b', border: '#ef4444' }, shape: 'dot', size: 20 },
                manager: { color: { background: '#1e293b', border: '#f59e0b' }, shape: 'dot' },
                company: { color: { background: '#1e293b', border: '#10b981' }, shape: 'square' },
                toxic: { color: { background: '#1e293b', border: '#ef4444' }, shape: 'diamond', size: 25 },
                official: { color: { background: '#1e293b', border: '#94a3b8' }, shape: 'star' },
                org: { color: { background: '#1e293b', border: '#a855f7' }, shape: 'star' }
            },
            physics: { forceAtlas2Based: { gravitationalConstant: -90, springLength: 150 }, solver: 'forceAtlas2Based' },
            interaction: { hover: true }
        };

        const container = document.getElementById('network-container');
        const network = new vis.Network(container, { nodes, edges }, options);

        network.on("stabilizationIterationsDone", function () { network.setOptions({ physics: { enabled: false } }); });
        network.on("dragStart", function () { network.setOptions({ physics: { enabled: true } }); });
        
        network.on("click", (p) => { 
            if (p.nodes.length > 0) {
                showNodeInfo(p.nodes[0]); 
            } else {
                closePanels();
            }
        });

        document.getElementById('node-search').addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase().trim();
            if(!term) { resetView(); return; }
            const foundArray = nodes.get({ filter: (n) => n.label.toLowerCase().includes(term) || (n.inn && n.inn.includes(term)) });
            if (foundArray && foundArray.length > 0) { 
                const found = foundArray[0];
                network.focus(found.id, { scale: 1.4, animation: true }); 
                network.selectNodes([found.id]); 
                showNodeInfo(found.id); 
            }
        });

        // –ì–õ–û–ë–ê–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò (–¥–æ—Å—Ç—É–ø–Ω—ã –∏–∑ HTML)
        function focusOnNode(id, scale = 1.5) {
            network.focus(id, { scale: scale, animation: true });
            network.selectNodes([id]);
            showNodeInfo(id);
        }

        function highlightPattern(patternType) {
            closeSidebar();
            
            const allNodes = nodes.get();
            allNodes.forEach(n => { n.color = undefined; n.hidden = false; });
            nodes.update(allNodes);

            const targetNodes = rawNodes.filter(n => n.riskPattern && n.riskPattern.includes(patternType)).map(n => n.id);
            
            let connectedNodes = new Set(targetNodes);
            rawEdges.forEach(e => {
                if (targetNodes.includes(e.from)) connectedNodes.add(e.to);
                if (targetNodes.includes(e.to)) connectedNodes.add(e.from);
            });

            const updates = allNodes.map(n => {
                if (!connectedNodes.has(n.id)) {
                    return { id: n.id, color: { background: '#0f172a', border: '#1e293b' }, font: { color: '#334155' } };
                }
                return { id: n.id };
            });
            nodes.update(updates);

            network.fit({ nodes: Array.from(connectedNodes), animation: true });
            showAnalyticReport(patternType, targetNodes);
        }

        function showAnalyticReport(type, nodeIds) {
            const report = document.getElementById('analytic-report');
            const title = document.getElementById('report-title');
            const text = document.getElementById('report-text');
            const list = document.getElementById('report-nodes');
            
            report.classList.remove('hidden');
            report.classList.add('risk-pulse');

            let htmlList = nodeIds.map(id => {
                const n = nodes.get(id);
                return `<div class="bg-slate-700/80 p-2 border border-slate-600 rounded text-xs text-white mb-1 cursor-pointer hover:bg-slate-600 transition-colors" onclick="focusOnNode('${id}', 1.8)">üéØ ${n.label}</div>`;
            }).join('');

            if (type === 'npo') {
                title.innerText = 'üõ°Ô∏è –£–∫—Ä—ã—Ç–∏–µ –≤ –ù–ö–û';
                text.innerHTML = '–ë–µ–Ω–µ—Ñ–∏—Ü–∏–∞—Ä—ã –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏—Ö –¥–æ–ª–∂–Ω–∏–∫–æ–≤ –º–∞—Å—Å–æ–≤–æ —É—á—Ä–µ–∂–¥–∞—é—Ç <b>–ü—Ä–∏—Ö–æ–¥—ã –∏ –§–æ–Ω–¥—ã</b>. <br><br><span class="text-indigo-400 font-bold">–¶–µ–ª—å:</span> –ü–µ—Ä–µ–¥–∞—á–∞ –∞–∫—Ç–∏–≤–æ–≤ –ø–æ–¥ –≤–∏–¥–æ–º "–ø–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–Ω–∏–π". –û–±—Ä–∞—Ç–∏—Ç—å –≤–∑—ã—Å–∫–∞–Ω–∏–µ –Ω–∞ –∏–º—É—â–µ—Å—Ç–≤–æ —Ä–µ–ª–∏–≥–∏–æ–∑–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –≤ —Ä–∞–º–∫–∞—Ö —Å—É–±—Å–∏–¥–∏–∞—Ä–Ω–æ–π –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –ø–æ—á—Ç–∏ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ.';
            } else if (type === 'hub') {
                title.innerText = 'üï∏Ô∏è –ú–µ–≥–∞-–•–∞–±—ã';
                text.innerHTML = '–í—ã—è–≤–ª–µ–Ω–∞ —Å–≤—è–∑—å –¥–æ–ª–∂–Ω–∏–∫–æ–≤ —Å –∫—Ä—É–ø–Ω—ã–º–∏ –Ω–µ–∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏–º–∏ —Ö–∞–±–∞–º–∏ (–ê—Å—Å–æ—Ü–∏–∞—Ü–∏—è "–ú–µ–≥–∞–ø–∏—Ä"). <br><br><span class="text-purple-400 font-bold">–¶–µ–ª—å:</span> –ö–∞–ø–∏—Ç–∞–ª —É—Ö–æ–¥–∏—Ç –≤ —Ö–∞–± –≤ –≤–∏–¥–µ –≤–∑–Ω–æ—Å–æ–≤, –ø–æ—Å–ª–µ —á–µ–≥–æ —Ä–∞—Å—Ç–≤–æ—Ä—è–µ—Ç—Å—è —Å—Ä–µ–¥–∏ –¥–µ—Å—è—Ç–∫–æ–≤ –¥–æ—á–µ—Ä–Ω–∏—Ö —Ñ–æ–Ω–¥–æ–≤, —Å—Ç–∞–Ω–æ–≤—è—Å—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–º –¥–ª—è –∫—Ä–µ–¥–∏—Ç–æ—Ä–æ–≤.';
            } else if (type === 'split') {
                title.innerText = '‚úÇÔ∏è –î—Ä–æ–±–ª–µ–Ω–∏–µ –∏ –í—ã–≤–æ–¥';
                text.innerHTML = '–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Å—Ö–µ–º–∞ <b>"–¶–µ–Ω—Ç—Ä –ø—Ä–∏–±—ã–ª–∏ / –¶–µ–Ω—Ç—Ä —É–±—ã—Ç–∫–æ–≤"</b>. <br><br><span class="text-orange-400 font-bold">–¶–µ–ª—å:</span> –¢–æ–∫—Å–∏—á–Ω—ã–µ –¥–æ–ª–≥–∏ (–∞—Ä–µ–Ω–¥–∞, –Ω–∞–ª–æ–≥–∏) —Å–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è –Ω–∞ –≠–ª—å—Ç–æ–Ω-2 (–±–∞–Ω–∫—Ä–æ—Ç), –∞ —Ä–µ–∞–ª—å–Ω–∞—è –≤—ã—Ä—É—á–∫–∞ –æ—Å–µ–¥–∞–µ—Ç –≤ –≠–ª—å—Ç–æ–Ω-–ú–µ–¥. –§–∏–∫—Ç–∏–≤–Ω—ã–µ –∑–∞—Ç—Ä–∞—Ç—ã –ø—Ä–æ–≤–æ–¥—è—Ç—Å—è —á–µ—Ä–µ–∑ –ø—Ä–æ–∫–ª–∞–¥–∫—É "–°–∞–º–æ—Ä–æ–≥–¥–∞".';
            }
            list.innerHTML = htmlList;
        }

        function showNodeInfo(id) {
            const node = nodes.get(id);
            if (!node) return;

            const sidebar = document.getElementById('info-sidebar');
            const content = document.getElementById('info-content');
            
            const connectedEdges = edges.get({ filter: e => e.from === id || e.to === id });
            let linksHtml = connectedEdges.map(e => {
                const other = nodes.get(e.from === id ? e.to : e.from);
                return `<div class="p-3 border-b border-slate-700/50 flex flex-col hover:bg-slate-700 cursor-pointer transition-colors" onclick="focusOnNode('${other.id}', 1.5)">
                            <span class="text-slate-400 text-xs uppercase mb-1">${e.label}</span>
                            <span class="text-slate-200 text-sm font-bold">${other.label}</span>
                        </div>`;
            }).join('');

            let warning = node.riskPattern ? `<div class="mt-3 p-3 bg-red-900/40 border border-red-500/50 rounded text-red-200 text-xs shadow-inner leading-relaxed">‚ö†Ô∏è <b>–§–æ—Ä–µ–Ω–∑–∏–∫-–º–∞—Ä–∫–µ—Ä:</b> –£–∑–µ–ª –≤–æ–∑–º–æ–∂–Ω–æ –≤–æ–≤–ª–µ—á–µ–Ω –≤ —Ñ–∏–Ω. –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–æ –≤—ã–≤–æ–¥—É/—Å–æ–∫—Ä—ã—Ç–∏—é –∞–∫—Ç–∏–≤–æ–≤.</div>` : '';

            content.innerHTML = `
                <div class="mb-4">
                    <h2 class="text-xl font-bold text-white">${node.label}</h2>
                    ${node.inn ? `<div class="text-xs font-mono bg-slate-700 text-blue-300 px-2 py-1 inline-block mt-2 rounded border border-slate-600">–ò–ù–ù: ${node.inn}</div>` : ''}
                </div>
                <div class="text-sm text-slate-300 bg-slate-700/30 p-3 rounded mb-4 leading-relaxed border border-slate-600/50 italic">
                    ${node.info || '–°–≤—è–∑—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ –≥—Ä–∞—Ñ–æ–º –∞—Ñ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏.'}
                </div>
                ${warning}
                <div class="mt-4 border-t border-slate-600 pt-4">
                    <h3 class="text-xs font-bold text-slate-500 uppercase mb-3">–ü—Ä—è–º—ã–µ —Å–≤—è–∑–∏ (${connectedEdges.length})</h3>
                    <div class="space-y-1">${linksHtml || '<span class="text-xs text-slate-500">–ù–µ—Ç —Å–≤—è–∑–µ–π</span>'}</div>
                </div>`;
            
            sidebar.classList.remove('hidden');
        }

        function closePanels() {
            closeSidebar();
            closeReport();
        }

        function closeSidebar() { 
            document.getElementById('info-sidebar').classList.add('hidden'); 
        }

        function closeReport() { 
            document.getElementById('analytic-report').classList.add('hidden');
            document.getElementById('analytic-report').classList.remove('risk-pulse');
        }

        function resetView() {
            const updates = rawNodes.map(n => ({ id: n.id, color: undefined, font: { color: '#f8fafc' } }));
            nodes.update(updates);
            closePanels();
            network.fit({ animation: true });
            document.getElementById('node-search').value = '';
        }
    </script>
</body>
</html>
